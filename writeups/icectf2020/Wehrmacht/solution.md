## Wehrmacht 

> We picked up this message on our really old equipment. Must have been a while in transit...

> stecker settings AQ and BJ and rotors I, II, III from the whermacht set. The ringstellungs are A, B, and C respectively.

After googling the words in this description, it is clear that this is an enigma machine challenge.

We are given the ciphertext, type of machine, rotors to mount (Walzenlage), initial position of rotor (Grundstellung), and the Plug board configuration (Steckerverbindungen). 

We need to find the initial position of rotor (Grundstellung) and the reflector (Umkehrwalze) in order to decode the ciphertext. There are only two possible reflectors for the parameters given (B and C) but several different initial positions, so I decided to brute force it with python.

```
import sys
from enigma.machine import EnigmaMachine

text = "MILFIRQKFRLQINVOOXQKNWRSQJOOLKEQDPIUYGUMLQPUAXEZIQAVHIFYLGQVGOTMLHBKZZELWELNRBACSWPRSXXBOVRGQZAKNZCMPGYGWBYBWKZBUTBQTXXBUCUCMRVIHQUJFYOQIMWJGKNMVLZPIDTBKXFRKFNVVRVFGGMVIWBXOGAXKEGQUDFUHVADFHYTQKWBMWQOLWAYWBLBPUYCIEGBESAFRXYSXXJRXSRUKMMUSLLPVLACHAXQPVNIQZFSLTYAKVHOTJLYKJMHNGVCTLLVISIUHEMXLNSKDUXPIJIBHFZYXBPANIBUEUAYEBXKHHAFYAVLZVEJQUCXNHVXVNKZATDLHQRBYXYKZXFLTGDBPHLADWRAMCFKVZHRTJBGDDSUILLVGQTYLOHPGQSMQXOHYIJGNPLJJZOLQODFRKAEXTKKJRZUTAKKQGJILTODZHVDEGLWYXEBVAMKCECWYPMWQWZZMKCKRVBDLUOMNWJUDTJXGMCKNUBQCQDRNMGMKXAHOUKNLYWMJPBMDWFDHAFAQZHBTGDKFCGNYOJAONXXMKXOASKCXCOWIZKHWCICWMASAPIQLLJMXWNWJIAZAVNUGDSKPTZJPAWEWWUQEDCJSEXXOJDUWWUBSNWWOIVSFNKFSVPEZHJAIDQGMATMSNDUGUCTDEAHKLELNQBCYHYZAXLNWYDTOUYQCOQHVGRXWXFBJZLORZJZLBTYSFXGYVYKFYDCTVIBOUKDTQBJPTIPYGJGINJVCAXOEQYFDJCPDTESZHWTKJYBOGBHIPDNQVLHWJQERQGLHIPKRYAZJMQHZSEZHJNKEMPEZSXGJJLFXCHXIRGIBSOOCMDONRWSBGZWYCTFBEZYGIFKHFKUKQPGRXDLYHKGENIBATOKHKQDOFJKZFLIYCMJSE"

def brute_ring_settings(ciphertext):
    for a in range(1, 26):
        for b in range(1, 26):
            for c in range(1, 26):
                machine = EnigmaMachine.from_key_sheet(
                   rotors='I II III',
                   reflector='B',
                   ring_settings=[a, b, c],
                   plugboard_settings='AQ BJ')
                plaintext = machine.process_text(ciphertext)
                if "ICECTF" in plaintext:
                    print('[+] Ring settings: {}, {}, {}'.format(a, b, c))
                    print(plaintext)
    return -1, -1, -1

a, b, c = brute_ring_settings(text)
print('Ring settings: {}, {}, {}'.format(a, b, c))
```

I ran the script with the reflector C and got no output. I then ran the script with the reflector B and got the following output:

```
[+] Ring settings: 18, 25, 24
ICECTFTURINGMACHIQIEUHEPARTICULARORDERWEHAVZXKDRPXXYJFNMDVOWCRDRCKCPFFQRNOFVQUUVDECIGLULRKLTSTTOKJUSSWHENTHEKEYQISDEPRESSKBSWDSUPPOSINGTHATCISCONNEBWTZTOCTHROUGHTHEWHEELSXTHVJHBYOUTLETFORTHEPOSITIVEOUNOFBATTERYISTHROUGHTHEQKEMZJBHENCETOCANDTHENTHROUGHUWYVBULBXTHERESULTISTHATTHVPMLLBLIGHTSXMOREGENERALLYDFVBNSAYIFTWOCONTACTSCZZDOZXIKEINTRITTSWALZARECONNECCAZSHROUGHTHEWHEELSTHENTHEUQFKLTOFENCIPHERINGTHELETTXDBISOCIATEDWITHCISTHELETTXMMGSOCIATEDWITHDXNOTICETHNDURPISTHERESULTOFENCIPHERQXEHZZTHENGISTHERESULTOFENQGHFERINGPATTHESAMEPLACEZZRQSOTHATTHERESULTOFENCIPHETOZTGCANNEVERBEGXONTHEWHEEMFQSERINGSORTYRESCARRYINGAKWJIBETSZZANDROTATABLEWITHBQKEECTTOTHERESTOFTHEWHEELQWWJABOUTTHISUNDERTURNOVEREQMBBVFDLGPCEIDIOXYIGVLYLNCCZIIZEFENEUOJXLNBKNJCPOYTLUAMCNTHEUXKXWXANDTHEEXWXIUFFHEPRESCRIBEDORDERXTHEWAHETCTTHECURRENTMIGHTFLOWFRNCKKEEXWXTHROUGHTHEWHEELSAURTGCKISSHOWNBELOWXVERYNICMCNZKXTHECODEISICECTFTURINQNGNHINEX
```

It's like... sorta correct. Looking at the end: ``THECODEISICECTFTURINQNGNHINEX``

After guessing a lot, I was able to guess the correct flag.

> IceCTF{turingmachine}